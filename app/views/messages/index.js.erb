$(function() {
	var $chatBox = $('#messages');
	var $requestScreen = $('.request_screen');
	<% @other_user = @conversation.get_other_user(current_user) %>
	// if user clicked is not a pending friend

	$('.chat-sidebar').remove();
	<% @pending = current_user.pending_friends.include? @other_user %>
	<% if !@pending %>
		$requestScreen.remove();
		console.log('not pending friend');
		if ( $chatBox.length == 0 ) {
			$('.pre-chat').remove();
			console.log('append');
		} else {
			$('.chat').remove();
			console.log('removed chat');
		}

		$('#chat').append('<%= j render("chat") %>');
		$('.chat-sidebar').remove();

		var $chatSidebar =  $('<div class="col-md-3 chat-sidebar"></div>');
		$chatSidebar.appendTo($('.row'));
		$chatSidebar.append('<%= j render("chat_sidebar", conversation: @conversation) %>');

		// Refresh the friend sidebar to update conv-ids of new conversations
		$('.friend-sidebar').remove(); 
		$('.friend-list').append('<%= j render("/conversations/friend_list") %>');
	<% else %>
		$('.chat').remove();
		$('#chat').append('<%= j render("chat") %>');
		console.log('pending friend');	
	<% end %>

	// add active class to current conversation
	$('.active-conversation').removeClass('active-conversation');
	$(".status-text[data-conv-id='<%=@conversation.id.to_s%>'").parent().parent().addClass("active-conversation");

	// update conversation id meta tag
	$('meta[name=conv-id]').attr("content", '<%= @conversation.id.to_s %>');

	// re-initialize scroll bar
	$('#messages').mCustomScrollbar({
	    theme:"minimal-dark",
	    advanced:{ 
	    	updateOnContentResize: true,
	    	updateOnSelectorChange: "div" 
	    }
	});

	$('#messages').mCustomScrollbar("scrollTo", 'bottom', {
		scrollInertia: 0
	});
});

