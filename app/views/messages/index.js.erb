$(function() {
	var $chatBox = $('#messages');
	var $requestScreen = $('.request_screen');
	<% @other_user = @conversation.get_other_user(current_user) %>
	// if user clicked is not a pending friend

	$('.chat-sidebar').remove();
	<% @pending = current_user.pending_friends.include? @other_user %>
	<% if !@pending %>
		$requestScreen.remove();
		console.log('not pending');
		if ( $chatBox.length == 0 ) {
			$('.pre-chat').remove();
			console.log('append');
		} else {
			$('.chat').remove();
			console.log('removed chat');
		}

		$('#chat').append('<%= j render("chat") %>');
		$('.chat-sidebar').remove();
		$('.row').append('<%= j render("chat_sidebar", conversation: @conversation) %>');
	<% else %>
		$('.chat').remove();
		$('#chat').append('<%= j render("chat") %>');
		console.log('pending');	
	<% end %>

	// add active class to current conversation
	$('.active-conversation').removeClass('active-conversation');
	$("div[data-conv-id='<%=@conversation.id.to_s%>'").parent().parent().addClass("active-conversation");

	// update conversation id meta tag
	$('meta[name=conv-id]').attr("content", '<%= @conversation.id.to_s %>');

	// re-initialize scroll bar
	$('#messages').mCustomScrollbar({
	    theme:"minimal-dark",
	    advanced:{ 
	    	updateOnContentResize: true,
	    	updateOnSelectorChange: "div" 
	    }
	});

	$('#messages').mCustomScrollbar("scrollTo", 'bottom', {
		scrollInertia: 0
	});
});

