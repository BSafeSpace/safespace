<% publish_to conversation_path(@conversation) do %>
	var sender_id = "<%= @message.user.id %>";
	var current_id = $('meta[name=user-id]').attr("content");

    if (sender_id != current_id) {
		console.log("got into logic block");
		$("#msg").append("<%= j render 'receiver' %>");
		$("#notif").append("<%= j render 'notif' %>");
	}
	else{
		$("#msg").append("<%= j render 'sender' %>");
	}

	// update message preview
	$("div[data-conv-id='<%=@conversation.id.to_s%>'").text("<%= j render '/conversations/message_preview' %>");

<% end %>

// Updates unread count on chat link in nav	
<% publish_to '/messages/new' do %>
	var sender_id = "<%= @message.user.id %>";
	var current_id = $('meta[name=user-id]').attr("content");
	var metaConvID = $('meta[name=conv-id]').attr("content");
	console.log('convID: ' + metaConvID);
	var rubyConvID = '<%= @conversation.id.to_s %>'
	console.log("rubyConvID: " + rubyConvID);
	if (sender_id != current_id) {
		$.ajax({
		   method: 'get',
		   url: '/conversations/' + rubyConvID + '/read_messages',
		   data: { metaConvID: metaConvID, 
		   		   rubyConvID: rubyConvID },
		   complete: function(response) {
			   	$('.unread-count').text("<%= @conversation.get_other_user(current_user).unread_count.to_s %>");
			   }
		});
	}
	console.log('unread-count: ' + "<%= @conversation.get_other_user(current_user).unread_count.to_s %>");
<% end %>

$("#new_message")[0].reset();

var $chatBox = $('#messages');
$chatBox.mCustomScrollbar("update");
$chatBox.mCustomScrollbar("scrollTo", 'bottom', {
	scrollInertia: 1000
});
